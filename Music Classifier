# -*- coding: utf-8 -*-
"""Homework: Create and describe a Classifier in Python and Simbrain

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/18k5FeX3eHI0OdaMn9mfx22T0a9y2WO6D

# Brief Document of what this code does

## 1. Data
- Source: https://www.kaggle.com/datasets/andradaolteanu/gtzan-dataset-music-genre-classification?utm_source=chatgpt.com
https://www.kaggle.com/datasets/harish24/music-genre-classification/data?select=dataset.csv
- Structrue: 1000 music clips, 10 music genres.
- Features: 26 in total. These data includes spectral and timbral descriptoirs such as chroma_stft and rolloff, and 20 MFCCs.
- Target: labels that include all of the 10 music genres such as blues and rock.

## 2. Clean up and data wrangling
-

# Import the packages
"""

import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from sklearn.decomposition import PCA
from sklearn.model_selection import train_test_split
from google.colab import files
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix
from sklearn.preprocessing import MinMaxScaler, OneHotEncoder
from sklearn.neural_network import MLPClassifier
from sklearn.model_selection import train_test_split

"""# Import the csv data"""

csv_url = "https://drive.google.com/uc?export=download&id=1dTfqbZVluxmmNRU_ob_5b33fnOgeuLMx"
MClass = pd.read_csv(csv_url)

"""# Wrangling

"""

# Seperate features and labels
X = MClass.drop(columns=['filename', 'label'])
y = MClass['label']

# Scale the data to [-1ï¼Œ 1] range for Simbrain training
scaler = MinMaxScaler(feature_range=(-1, 1))
X_scaled = scaler.fit_transform(X)

# Onehot encode labels
encoder = OneHotEncoder (sparse_output = False)
y_onehot = encoder.fit_transform(y.values.reshape(-1, 1))

# Keep the genres names
class_names = encoder.categories_[0].tolist()

print("X_scaled shape:", X_scaled.shape)
print("y_onehot shape:", y_onehot.shape)
print("Class names:", class_names[:10])

"""# Data Visualization (Very Pretty!)"""

# PCA
pca = PCA(n_components=2)
X_reduced = pca.fit_transform(X_scaled)

# Scatter Plot
plt.figure(figsize=(7, 5))
for i, genre in enumerate(class_names):
    index = (y == genre)
    plt.scatter(X_reduced[index, 0], X_reduced[index, 1], label=genre, s = 12)

plt.xlabel("PC 1")
plt.ylabel("PC 2")
plt.title("Music Features")
plt.legend(markerscale = 3, fontsize = 8, frameon = False)
plt.show()

"""# Split the data, training, and export"""

X_train, X_test, y_train, y_test = train_test_split(X_scaled, y, test_size = 0.2, random_state=42, stratify = y)

X_train.shape, X_test.shape, y_train.shape, y_test.shape

mlp_Classifier = MLPClassifier(hidden_layer_sizes = (32, 16,), activation = 'tanh', solver = 'adam', max_iter = 1000, random_state = 42)
mlp_Classifier.fit(X_train, y_train)

# Predictions
y_pred = mlp_Classifier.predict(X_test)

print ("Accuracy:", accuracy_score(y_test, y_pred))
print ("\nClassification Report:\n", classification_report(y_test, y_pred))
print ("\nConfusion Matrix:\n", confusion_matrix(y_test, y_pred, labels = class_names))

rf_classifier = RandomForestClassifier(random_state=42)
rf_classifier.fit(X_train, y_train)

# Get predictions
rf_pred = rf_classifier.predict(X_test)

print ("Accuracy:", accuracy_score(y_test, rf_pred))
print ("\nClassification Report:\n", classification_report(y_test, rf_pred))
print ("\nConfusion Matrix:\n", confusion_matrix(y_test, rf_pred, labels = class_names))

# Export data to CSV files
# Export the inputs (headers included)
X_train_df = pd.DataFrame(X_train)
X_test_df = pd.DataFrame(X_test)
# Export the lables (headers included)
y_train_df = pd.DataFrame(pd.get_dummies(y_train))
y_test_df = pd.DataFrame(pd.get_dummies(y_test))

X_train_df.to_csv('X_train.csv', index=False, header=False)
X_test_df.to_csv('X_test.csv', index=False, header=False)
y_train_df.to_csv('y_train.csv', index=False, header=False)
y_test_df.to_csv('y_test.csv', index=False, header=False)

print("Data exported to CSV files: X_train.csv, X_test.csv, y_train.csv, y_test.csv")
